<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leaderboard</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="session.js"></script>

</head>

<body>
    <div id="leaderboard-box">
        <h2>ğŸ† Top Players</h2>
        <div id="board">Loading...</div>
        
        <div class="leader-nav">
            <a href="home.html" id="homeBtn" class="btn outline">Home ğŸ </a>
            <a href="game.html" class="btn gold">Play Game ğŸ®</a>
        </div>
    </div>

    <button id="soundToggle">ğŸ”Š Sound ON</button>

    <script type="module">
        import { initSounds, playClick, toggleSound, isSoundEnabled } from "./sound.js";
        import { auth, db } from "./firebase.js";
        import { collection, query, orderBy, limit, getDocs } 
        from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        initSounds();

        const toggleBtn = document.getElementById("soundToggle");
        toggleBtn.addEventListener("click", () => {
            const enabled = toggleSound();
            toggleBtn.textContent = enabled ? "ğŸ”Š Sound ON" : "ğŸ”‡ Sound OFF";
        });
        toggleBtn.textContent = isSoundEnabled() ? "ğŸ”Š Sound ON" : "ğŸ”‡ Sound OFF";

        // Click sound
        function addClickSoundWithNavigation(selector, href = null) {
            document.querySelectorAll(selector).forEach(el => {
                el.addEventListener("click", (e) => {
                    playClick();
                    if (href) {
                        e.preventDefault();
                        setTimeout(() => window.location.href = href, 150);
                    }
                });
            });
        }

        addClickSoundWithNavigation("#homeBtn", "home.html");
        addClickSoundWithNavigation(".btn.gold", "game.html");

        function capitalizeFirst(str) {
            if (!str) return "";
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        async function loadBoard() {
            const user = await new Promise(resolve => {
                const unsub = auth.onAuthStateChanged(u => {
                    unsub();
                    resolve(u);
                });
            });

            const q = query(collection(db, "leaderboard"), orderBy("score", "asc"), limit(10));
            const snap = await getDocs(q);

            if (snap.empty) {
                document.getElementById("board").innerHTML = "<p>No scores yet.</p>";
                return;
            }

            let html = "<ol>";
            snap.forEach(doc => {
                const d = doc.data();
                const playerName = capitalizeFirst(d.name);
                const isMe = user && d.uid === user.uid;
                html += `<li class="${isMe ? "me" : ""}">
                            ${playerName} â€” <b>${d.score}s</b>
                            ${isMe ? " â­" : "" }
                        </li>`;
            });
            html += "</ol>";

            document.getElementById("board").innerHTML = html;
        }

        loadBoard();

    </script>
</body>
</html>
